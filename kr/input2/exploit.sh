#!/bin/bash

# SSH connection details
USER="input2"
HOST="pwnable.kr"
PORT="2222"
PASS="guest"

# Local exploit path (adjust if needed)
LOCAL_EXPLOIT="./exploit.py"

# Remote commands to run after SSH
read -r -d '' REMOTE_CMDS <<'EOF'
TMPDIR=$(mktemp -d)
cd "$TMPDIR"
for f in $HOME/*; do
    ln -s "$f" .
done
exec bash
EOF

# Copy exploit.py and run it remotely
sshpass -p "$PASS" ssh -p "$PORT" -o StrictHostKeyChecking=no "$USER@$HOST" "
TMPDIR=\$(mktemp -d)
cd \"\$TMPDIR\"
for f in \$HOME/*; do
    ln -s \"\$f\" .
done
echo \$TMPDIR
exit
" > tmpdir.txt
TMPDIR=$(cat tmpdir.txt)
rm tmpdir.txt
# Copy the exploit script to the remote server and execute it
sshpass -p "$PASS" scp -P "$PORT" "$LOCAL_EXPLOIT" "$USER@$HOST:$TMPDIR/exploit.py"
sshpass -p "$PASS" ssh -p "$PORT" "$USER@$HOST" "cd $TMPDIR && python exploit.py"